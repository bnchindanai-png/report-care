<!doctype html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
</head>

<body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
</body>

</html>
.header {
background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
color: white;
padding: 30px;
border-radius: 15px;
text-align: center;
margin-bottom: 30px;
box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
}

.header h1 {
font-size: 32px;
font-weight: 700;
margin-bottom: 10px;
}

.header p {
font-size: 18px;
font-weight: 400;
opacity: 0.95;
}

.navigation {
display: flex;
gap: 15px;
margin-bottom: 25px;
flex-wrap: wrap;
justify-content: center;
}

.nav-button {
flex: 1;
min-width: 180px;
padding: 15px 25px;
border: none;
border-radius: 10px;
font-size: 18px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
font-family: 'Sarabun', sans-serif;
}

.nav-button.active {
background: #2196F3;
color: white;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
}

.nav-button:not(.active) {
background: white;
color: #2196F3;
}

.nav-button:not(.active):hover {
background: #E3F2FD;
transform: translateY(-1px);
}

.page-section {
display: none;
background: white;
padding: 30px;
border-radius: 15px;
box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
}

.page-section.active {
display: block;
}

.input-group {
margin-bottom: 20px;
}

.input-group label {
display: block;
margin-bottom: 8px;
font-weight: 600;
color: #1976D2;
font-size: 16px;
}

.required-mark {
color: #f44336;
margin-left: 4px;
}

.input-group input,
.input-group textarea,
.input-group select {
width: 100%;
padding: 12px 15px;
border: 2px solid #E3F2FD;
border-radius: 8px;
font-size: 16px;
font-family: 'Sarabun', sans-serif;
transition: border-color 0.3s ease;
}

.input-group input:focus,
.input-group textarea:focus,
.input-group select:focus {
outline: none;
border-color: #2196F3;
}

.input-group textarea {
min-height: 100px;
resize: vertical;
}

.upload-zone {
border: 2px dashed #E3F2FD;
border-radius: 8px;
padding: 20px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
}

.upload-zone:hover {
border-color: #2196F3;
background: #f8fbff;
}

.upload-zone.dragover {
border-color: #2196F3;
background: #E3F2FD;
}

.upload-icon {
font-size: 48px;
margin-bottom: 10px;
}

.upload-instruction {
color: #666;
font-size: 16px;
}

.image-preview-container {
margin-top: 15px;
display: none;
}

.image-preview-container.show {
display: block;
}

.preview-img {
max-width: 100%;
max-height: 300px;
border-radius: 8px;
margin-top: 10px;
}

.file-details {
background: #E3F2FD;
padding: 10px 15px;
border-radius: 6px;
margin-top: 10px;
display: flex;
justify-content: space-between;
align-items: center;
}

.filename {
color: #1976D2;
font-weight: 600;
}

.delete-file-button {
background: #f44336;
color: white;
border: none;
padding: 5px 15px;
border-radius: 5px;
cursor: pointer;
font-size: 14px;
font-weight: 600;
font-family: 'Sarabun', sans-serif;
}

.save-button {
width: 100%;
padding: 15px;
background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
color: white;
border: none;
border-radius: 10px;
font-size: 18px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 20px;
font-family: 'Sarabun', sans-serif;
}

.save-button:hover:not(:disabled) {
transform: translateY(-2px);
box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
}

.save-button:disabled {
opacity: 0.6;
cursor: not-allowed;
}

.report-list {
display: grid;
gap: 20px;
}

.report-item {
background: linear-gradient(135deg, #ffffff 0%, #f8fbff 100%);
border: 2px solid #E3F2FD;
border-radius: 12px;
padding: 25px;
transition: all 0.3s ease;
}

.report-item:hover {
transform: translateY(-3px);
box-shadow: 0 6px 20px rgba(33, 150, 243, 0.15);
}

.report-top {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
padding-bottom: 15px;
border-bottom: 2px solid #E3F2FD;
flex-wrap: wrap;
gap: 10px;
}

.report-datetime {
color: #1976D2;
font-weight: 700;
font-size: 18px;
}

.report-buttons {
display: flex;
gap: 10px;
}

.report-content {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 15px;
margin-bottom: 15px;
}

.content-field {
display: flex;
flex-direction: column;
}

.field-title {
font-weight: 600;
color: #1976D2;
font-size: 14px;
margin-bottom: 4px;
}

.field-text {
color: #333;
font-size: 16px;
}

.report-picture {
margin-top: 15px;
}

.report-picture img {
max-width: 100%;
max-height: 400px;
border-radius: 8px;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.button-control {
padding: 8px 20px;
border: none;
border-radius: 6px;
font-size: 14px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
font-family: 'Sarabun', sans-serif;
}

.button-edit {
background: #4CAF50;
color: white;
}

.button-edit:hover:not(:disabled) {
background: #45a049;
transform: translateY(-1px);
}

.button-delete {
background: #f44336;
color: white;
}

.button-delete:hover:not(:disabled) {
background: #d32f2f;
transform: translateY(-1px);
}

.button-control:disabled {
opacity: 0.6;
cursor: not-allowed;
}

.button-acknowledge {
background: #FF9800;
color: white;
}

.button-acknowledge:hover:not(:disabled) {
background: #F57C00;
transform: translateY(-1px);
}

.acknowledged-badge {
background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
color: white;
padding: 6px 12px;
border-radius: 20px;
font-size: 14px;
font-weight: 600;
display: inline-flex;
align-items: center;
gap: 6px;
}

.acknowledged-badge::before {
content: "‚úì";
background: white;
color: #4CAF50;
width: 18px;
height: 18px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 12px;
}

.no-data {
text-align: center;
padding: 60px 20px;
color: #666;
}

.no-data-icon {
font-size: 64px;
margin-bottom: 20px;
opacity: 0.5;
}

.no-data-message {
font-size: 20px;
font-weight: 500;
}

.notification-toast {
position: fixed;
top: 20px;
right: 20px;
background: white;
padding: 20px 25px;
border-radius: 10px;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
display: none;
z-index: 1000;
min-width: 300px;
border-left: 5px solid #2196F3;
}

.notification-toast.show {
display: block;
animation: slideInRight 0.3s ease;
}

.notification-toast.success {
border-left-color: #4CAF50;
}

.notification-toast.error {
border-left-color: #f44336;
}

@keyframes slideInRight {
from {
transform: translateX(400px);
opacity: 0;
}

to {
transform: translateX(0);
opacity: 1;
}
}

.popup-backdrop {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.5);
z-index: 999;
align-items: center;
justify-content: center;
}

.popup-backdrop.show {
display: flex;
}

.popup-box {
background: white;
padding: 30px;
border-radius: 15px;
max-width: 500px;
width: 90%;
box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
max-height: 90%;
overflow-y: auto;
}

.popup-box h3 {
color: #1976D2;
margin-bottom: 20px;
font-size: 22px;
}

.popup-actions {
display: flex;
gap: 10px;
margin-top: 20px;
}

.popup-button {
flex: 1;
padding: 12px;
border: none;
border-radius: 8px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
font-family: 'Sarabun', sans-serif;
}

.popup-button.primary {
background: #2196F3;
color: white;
}

.popup-button.primary:hover:not(:disabled) {
background: #1976D2;
}

.popup-button.danger {
background: #f44336;
color: white;
}

.popup-button.danger:hover:not(:disabled) {
background: #d32f2f;
}

.popup-button.secondary {
background: #E3F2FD;
color: #2196F3;
}

.popup-button.secondary:hover {
background: #BBDEFB;
}

.popup-button:disabled {
opacity: 0.6;
cursor: not-allowed;
}

.date-selector {
display: flex;
gap: 15px;
margin-bottom: 25px;
align-items: center;
flex-wrap: wrap;
}

.date-selector input {
padding: 12px 15px;
border: 2px solid #E3F2FD;
border-radius: 8px;
font-size: 16px;
font-family: 'Sarabun', sans-serif;
}

.date-selector button {
padding: 12px 25px;
background: #2196F3;
color: white;
border: none;
border-radius: 8px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
font-family: 'Sarabun', sans-serif;
}

.date-selector button:hover {
background: #1976D2;
}

.count-display {
text-align: center;
padding: 15px;
background: #E3F2FD;
border-radius: 10px;
margin-bottom: 20px;
font-size: 18px;
font-weight: 600;
color: #1976D2;
}

.spinner-overlay {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(255, 255, 255, 0.9);
z-index: 9999;
align-items: center;
justify-content: center;
}

.spinner-overlay.show {
display: flex;
}

.spinner-content {
text-align: center;
}

.spinner-circle {
border: 5px solid #E3F2FD;
border-top: 5px solid #2196F3;
border-radius: 50%;
width: 60px;
height: 60px;
animation: spin 1s linear infinite;
margin: 0 auto 20px;
}

@keyframes spin {
0% {
transform: rotate(0deg);
}

100% {
transform: rotate(360deg);
}
}

.spinner-message {
font-size: 18px;
font-weight: 600;
color: #1976D2;
}

@media print {
body {
padding: 20px;
}

.hide-print {
display: none;
}

@page {
size: A4;
margin: 15mm;
}
}

@media (max-width: 768px) {
.header h1 {
font-size: 24px;
}

.header p {
font-size: 16px;
}

.navigation {
flex-direction: column;
}

.nav-button {
min-width: 100%;
}

.report-content {
grid-template-columns: 1fr;
}

.report-buttons {
width: 100%;
}
}
</style>
<style>
    @view-transition {
        navigation: auto;
    }
</style>
<script src="/_sdk/data_sdk.js" type="text/javascript"></script>
<script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>

<body>
    <div class="app-wrapper">
        <header class="header">
            <h1 id="title-system">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p id="title-organization">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡πÄ‡∏Ç‡∏ï‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 6 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ</p>
        </header>
        <nav class="navigation"><button class="nav-button active" onclick="changeTab('add')">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
            <button class="nav-button" onclick="changeTab('all')">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button> <button class="nav-button"
                onclick="changeTab('daily')">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</button> <button class="nav-button"
                onclick="changeTab('admin')">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </nav>
        <main>
            <section id="section-add" class="page-section active">
                <h2 style="color: #1976D2; margin-bottom: 25px; font-size: 26px;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
                <form id="form-report">
                    <div class="input-group"><label for="input-date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span
                                class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="date" id="input-date"
                            required>
                    </div>
                    <div class="input-group"><label for="input-time">‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà <span
                                class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="time" id="input-time"
                            required>
                    </div>
                    <div class="input-group"><label for="input-staff">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà <span
                                class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="text" id="input-staff"
                            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                    </div>
                    <div class="input-group"><label for="input-position">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <span
                                class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="text" id="input-position"
                            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" required>
                    </div>
                    <div class="input-group"><label for="input-location">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà <span
                                class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="text" id="input-location"
                            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà" required>
                    </div>
                    <div class="input-group"><label for="input-activity">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ <span
                                class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <textarea id="input-activity"
                            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥" required></textarea>
                    </div>
                    <div class="input-group"><label for="input-event">‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label> <textarea
                            id="input-event" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ"></textarea>
                    </div>
                    <div class="input-group"><label for="input-note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <textarea id="input-note"
                            placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ"></textarea>
                    </div>
                    <div class="input-group"><label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label> <input type="file" id="file-main" accept="image/*"
                            style="display: none;">
                        <div class="upload-zone" id="zone-main">
                            <div class="upload-icon">
                                üì∑
                            </div>
                            <div class="upload-instruction">
                                ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                            </div>
                        </div>
                        <div class="image-preview-container" id="preview-main"><img id="img-main" class="preview-img"
                                alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û">
                            <div class="file-details"><span class="filename" id="name-main"></span> <button
                                    type="button" class="delete-file-button" onclick="clearMainFile()">‡∏•‡∏ö‡∏£‡∏π‡∏õ</button>
                            </div>
                        </div>
                    </div><button type="submit" class="save-button" id="button-submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                </form>
            </section>
            <section id="section-all" class="page-section">
                <h2 style="color: #1976D2; margin-bottom: 25px; font-size: 26px;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <div style="margin-bottom: 20px;"><button onclick="showPrintPopup()" class="save-button"
                        style="margin-top: 0; background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);">
                        ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô </button>
                </div>
                <div id="count-all" class="count-display"></div>
                <div id="list-all" class="report-list"></div>
            </section>
            <section id="section-daily" class="page-section">
                <h2 style="color: #1976D2; margin-bottom: 25px; font-size: 26px;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h2>
                <div class="date-selector"><label style="font-weight: 600; color: #1976D2;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label> <input
                        type="date" id="date-daily"> <button onclick="searchDaily()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                </div>
                <div id="count-daily" class="count-display"></div>
                <div id="list-daily" class="report-list"></div>
            </section>
            <section id="section-admin" class="page-section">
                <h2 style="color: #1976D2; margin-bottom: 25px; font-size: 26px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                <div id="count-admin" class="count-display"></div>
                <div id="list-admin" class="report-list"></div>
            </section>
        </main>
    </div>
    <div id="overlay-spinner" class="spinner-overlay">
        <div class="spinner-content">
            <div class="spinner-circle"></div>
            <div class="spinner-message" id="text-spinner">
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
            </div>
        </div>
    </div>
    <div id="toast-notification" class="notification-toast"></div>
    <div id="popup-password" class="popup-backdrop">
        <div class="popup-box">
            <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
            <div class="input-group"><label for="input-password">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password"
                    id="input-password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            </div>
            <div class="popup-actions"><button class="popup-button secondary"
                    onclick="hidePasswordPopup()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button> <button class="popup-button primary"
                    onclick="checkPassword()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
        </div>
    </div>
    <div id="popup-delete" class="popup-backdrop">
        <div class="popup-box">
            <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
            <p style="margin-bottom: 20px; color: #666; font-size: 16px;">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ</p>
            <div id="info-delete"
                style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ff9800;">
            </div>
            <div class="popup-actions"><button class="popup-button secondary"
                    onclick="hideDeletePopup()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button> <button class="popup-button danger"
                    id="button-confirm-delete" onclick="executeDelete()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</button>
            </div>
        </div>
    </div>
    <div id="popup-print" class="popup-backdrop">
        <div class="popup-box">
            <h3>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
            <div class="input-group"><label for="date-print-start">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô <span
                        class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="date" id="date-print-start"
                    required>
            </div>
            <div class="input-group"><label for="date-print-end">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î <span
                        class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="date" id="date-print-end" required>
            </div>
            <div class="popup-actions"><button class="popup-button secondary" onclick="hidePrintPopup()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="popup-button primary" onclick="createPrintPage()" style="background: #4CAF50;">
                    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô </button>
            </div>
        </div>
    </div>
    <div id="popup-edit" class="popup-backdrop">
        <div class="popup-box">
            <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
            <form id="form-edit">
                <div class="input-group"><label for="edit-date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span
                            class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="date" id="edit-date" required>
                </div>
                <div class="input-group"><label for="edit-time">‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà <span
                            class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="time" id="edit-time" required>
                </div>
                <div class="input-group"><label for="edit-staff">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà <span
                            class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="text" id="edit-staff" required>
                </div>
                <div class="input-group"><label for="edit-position">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <span
                            class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="text" id="edit-position"
                        required>
                </div>
                <div class="input-group"><label for="edit-location">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà <span
                            class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <input type="text" id="edit-location"
                        required>
                </div>
                <div class="input-group"><label for="edit-activity">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ <span
                            class="required-mark">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å</span></label> <textarea id="edit-activity"
                        required></textarea>
                </div>
                <div class="input-group"><label for="edit-event">‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label> <textarea
                        id="edit-event"></textarea>
                </div>
                <div class="input-group"><label for="edit-note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <textarea id="edit-note"></textarea>
                </div>
                <div class="input-group"><label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label> <input type="file" id="file-edit" accept="image/*"
                        style="display: none;">
                    <div class="upload-zone" id="zone-edit">
                        <div class="upload-icon">
                            üì∑
                        </div>
                        <div class="upload-instruction">
                            ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                        </div>
                    </div>
                    <div class="image-preview-container" id="preview-edit"><img id="img-edit" class="preview-img"
                            alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û">
                        <div class="file-details"><span class="filename" id="name-edit"></span> <button type="button"
                                class="delete-file-button" onclick="clearEditFile()">‡∏•‡∏ö‡∏£‡∏π‡∏õ</button>
                        </div>
                    </div>
                </div>
                <div class="popup-actions"><button type="button" class="popup-button secondary"
                        onclick="hideEditPopup()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button> <button type="submit" class="popup-button primary"
                        id="button-update">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </div>
            </form>
        </div>
    </div>
    <div id="popup-acknowledge" class="popup-backdrop">
        <div class="popup-box">
            <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
            <p style="margin-bottom: 20px; color: #666; font-size: 16px;">
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</p>
            <div class="input-group"><label for="input-director-password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£</label> <input
                    type="password" id="input-director-password" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            </div>
            <div id="info-acknowledge"
                style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ff9800;">
            </div>
            <div class="popup-actions"><button class="popup-button secondary"
                    onclick="hideAcknowledgePopup()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button> <button class="popup-button primary"
                    id="button-confirm-acknowledge" onclick="executeAcknowledge()"
                    style="background: #FF9800;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
            </div>
        </div>
    </div>
    <script>
        const GOOGLE_SHEET_ID = '1TLuQMZUvdXR-5CH_jTJ3GHMqXchmlkkAc7yg5ZLG2dU';
        const API_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxHY8wqA9JSN7GJx5F31IpkYOIJn0bZEsg_bFrlWLvkTrX-diCI7DD7qOG1KfU4AQW2-A/exec?sheetId=' + GOOGLE_SHEET_ID;
        const SECRET_PASSWORD = '123456';
        const DIRECTOR_PASSWORD = '789012';

        let dataRecords = [];
        let selectedDeleteRecord = null;
        let selectedEditRecord = null;
        let selectedAcknowledgeRecord = null;
        let mainImageFile = null;
        let editImageFile = null;

        const defaultSettings = {
            system_title: '‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
            organization_name: '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡πÄ‡∏Ç‡∏ï‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 6 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ'
        };

        async function updateDisplay(settings) {
            document.getElementById('title-system').textContent = settings.system_title || defaultSettings.system_title;
            document.getElementById('title-organization').textContent = settings.organization_name || defaultSettings.organization_name;
        }

        function getCurrentDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return year + '-' + month + '-' + day;
        }

        async function startApp() {
            const currentDate = getCurrentDate();
            document.getElementById('input-date').value = currentDate;
            document.getElementById('date-daily').value = currentDate;

            prepareMainUpload();
            prepareEditUpload();
            await loadAllData();

            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig: defaultSettings,
                    onConfigChange: updateDisplay,
                    mapToCapabilities: (settings) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (settings) => new Map([
                        ['system_title', settings.system_title || defaultSettings.system_title],
                        ['organization_name', settings.organization_name || defaultSettings.organization_name]
                    ])
                });
            }
        }

        function prepareMainUpload() {
            const fileInput = document.getElementById('file-main');
            const uploadZone = document.getElementById('zone-main');
            const previewContainer = document.getElementById('preview-main');
            const previewImage = document.getElementById('img-main');
            const fileName = document.getElementById('name-main');

            uploadZone.addEventListener('click', () => fileInput.click());

            uploadZone.addEventListener('dragover', (event) => {
                event.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (event) => {
                event.preventDefault();
                uploadZone.classList.remove('dragover');
                const files = event.dataTransfer.files;
                if (files.length > 0) {
                    processMainFile(files[0]);
                }
            });

            fileInput.addEventListener('change', (event) => {
                if (event.target.files.length > 0) {
                    processMainFile(event.target.files[0]);
                }
            });

            function processMainFile(file) {
                if (!file.type.startsWith('image/')) {
                    showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    showNotification('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡πÄ‡∏°‡∏Å‡∏∞‡πÑ‡∏ö‡∏ï‡πå', 'error');
                    return;
                }

                mainImageFile = file;
                fileName.textContent = file.name;

                const reader = new FileReader();
                reader.onload = (event) => {
                    previewImage.src = event.target.result;
                    previewContainer.classList.add('show');
                };
                reader.readAsDataURL(file);
            }
        }

        function prepareEditUpload() {
            const fileInput = document.getElementById('file-edit');
            const uploadZone = document.getElementById('zone-edit');
            const previewContainer = document.getElementById('preview-edit');
            const previewImage = document.getElementById('img-edit');
            const fileName = document.getElementById('name-edit');

            uploadZone.addEventListener('click', () => fileInput.click());

            uploadZone.addEventListener('dragover', (event) => {
                event.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (event) => {
                event.preventDefault();
                uploadZone.classList.remove('dragover');
                const files = event.dataTransfer.files;
                if (files.length > 0) {
                    processEditFile(files[0]);
                }
            });

            fileInput.addEventListener('change', (event) => {
                if (event.target.files.length > 0) {
                    processEditFile(event.target.files[0]);
                }
            });

            function processEditFile(file) {
                if (!file.type.startsWith('image/')) {
                    showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    showNotification('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡πÄ‡∏°‡∏Å‡∏∞‡πÑ‡∏ö‡∏ï‡πå', 'error');
                    return;
                }

                editImageFile = file;
                fileName.textContent = file.name;

                const reader = new FileReader();
                reader.onload = (event) => {
                    previewImage.src = event.target.result;
                    previewContainer.classList.add('show');
                };
                reader.readAsDataURL(file);
            }
        }

        function clearMainFile() {
            mainImageFile = null;
            document.getElementById('file-main').value = '';
            document.getElementById('preview-main').classList.remove('show');
            document.getElementById('img-main').src = '';
            document.getElementById('name-main').textContent = '';
        }

        function clearEditFile() {
            editImageFile = null;
            document.getElementById('file-edit').value = '';
            document.getElementById('preview-edit').classList.remove('show');
            document.getElementById('img-edit').src = '';
            document.getElementById('name-edit').textContent = '';
        }

        async function loadAllData() {
            showSpinner('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');

            try {
                const response = await fetch(API_ENDPOINT + '&action=read&timestamp=' + Date.now());
                const text = await response.text();

                let result;
                try {
                    result = JSON.parse(text);
                } catch (error) {
                    console.error('JSON Parse Error:', error, 'Response:', text);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ');
                }

                if (result.success) {
                    dataRecords = result.data.sort((first, second) => new Date(second.timestamp) - new Date(first.timestamp));

                    displayAllReports();
                    displayAdminReports();

                    const selectedDaily = document.getElementById('date-daily').value;
                    if (selectedDaily) {
                        searchDaily();
                    }
                } else {
                    throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                }
            } catch (error) {
                console.error('Load Error:', error);
                showNotification(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                dataRecords = [];
                displayAllReports();
                displayAdminReports();
            } finally {
                hideSpinner();
            }
        }

        document.getElementById('form-report').addEventListener('submit', async (event) => {
            event.preventDefault();

            const submitButton = document.getElementById('button-submit');
            submitButton.disabled = true;
            submitButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';

            showSpinner('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô');

            try {
                let imageBase64 = '';
                let imageName = '';
                let imageType = '';

                if (mainImageFile) {
                    const base64Full = await convertToBase64(mainImageFile);
                    imageBase64 = base64Full.split(',')[1];
                    imageName = mainImageFile.name;
                    imageType = mainImageFile.type;
                }

                const dateInput = document.getElementById('input-date').value;
                const dateParts = dateInput.split('-').map(Number);
                const dateISO = new Date(Date.UTC(dateParts[0], dateParts[1] - 1, dateParts[2])).toISOString();

                const timeInput = document.getElementById('input-time').value;
                const timeFormatted = timeInput.replace(':', '.') + ' ‡∏ô.';

                const requestParams = new URLSearchParams({
                    action: 'create',
                    reportDate: dateISO,
                    dutyTime: timeFormatted,
                    staffName: document.getElementById('input-staff').value,
                    position: document.getElementById('input-position').value,
                    location: document.getElementById('input-location').value,
                    activity: document.getElementById('input-activity').value,
                    eventDetail: document.getElementById('input-event').value,
                    note: document.getElementById('input-note').value,
                    imageData: imageBase64,
                    imageName: imageName,
                    imageMimeType: imageType
                });

                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    body: requestParams
                });

                const text = await response.text();
                let result;
                try {
                    result = JSON.parse(text);
                } catch (error) {
                    console.error('JSON Parse Error:', error, 'Response:', text);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }

                if (result.success) {
                    showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    document.getElementById('form-report').reset();
                    clearMainFile();

                    document.getElementById('input-date').value = getCurrentDate();

                    await loadAllData();
                } else {
                    throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
                }
            } catch (error) {
                console.error('Submit Error:', error);
                showNotification(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô';
                hideSpinner();
            }
        });

        document.getElementById('form-edit').addEventListener('submit', async (event) => {
            event.preventDefault();

            const updateButton = document.getElementById('button-update');
            updateButton.disabled = true;
            updateButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';

            showSpinner('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô');

            try {
                let imageBase64 = '';
                let imageName = '';
                let imageType = '';
                let existingUrl = selectedEditRecord.imageUrl || '';

                if (editImageFile) {
                    const base64Full = await convertToBase64(editImageFile);
                    imageBase64 = base64Full.split(',')[1];
                    imageName = editImageFile.name;
                    imageType = editImageFile.type;
                }

                const editDateInput = document.getElementById('edit-date').value;
                const editDateParts = editDateInput.split('-').map(Number);
                const editDateISO = new Date(Date.UTC(editDateParts[0], editDateParts[1] - 1, editDateParts[2])).toISOString();

                const editTimeInput = document.getElementById('edit-time').value;
                const editTimeFormatted = editTimeInput.replace(':', '.') + ' ‡∏ô.';

                const requestParams = new URLSearchParams({
                    action: 'update',
                    id: selectedEditRecord.id,
                    reportDate: editDateISO,
                    dutyTime: editTimeFormatted,
                    staffName: document.getElementById('edit-staff').value,
                    position: document.getElementById('edit-position').value,
                    location: document.getElementById('edit-location').value,
                    activity: document.getElementById('edit-activity').value,
                    eventDetail: document.getElementById('edit-event').value,
                    note: document.getElementById('edit-note').value,
                    imageData: imageBase64,
                    imageName: imageName,
                    imageMimeType: imageType,
                    existingImageUrl: existingUrl
                });

                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    body: requestParams
                });

                const text = await response.text();
                let result;
                try {
                    result = JSON.parse(text);
                } catch (error) {
                    console.error('JSON Parse Error:', error, 'Response:', text);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }

                if (result.success) {
                    showNotification('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    hideEditPopup();
                    await loadAllData();
                } else {
                    throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï');
                }
            } catch (error) {
                console.error('Update Error:', error);
                showNotification(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            } finally {
                updateButton.disabled = false;
                updateButton.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
                hideSpinner();
            }
        });

        function convertToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        function changeTab(tabName) {
            document.querySelectorAll('.nav-button').forEach(button => button.classList.remove('active'));
            document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById('section-' + tabName).classList.add('active');

            if (tabName === 'daily') {
                searchDaily();
            }
        }

        function displayAllReports() {
            const listContainer = document.getElementById('list-all');
            const countContainer = document.getElementById('count-all');

            countContainer.textContent = '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ' + dataRecords.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';

            if (dataRecords.length === 0) {
                listContainer.innerHTML = '<div class="no-data"><div class="no-data-icon">üìã</div><div class="no-data-message">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div></div>';
                return;
            }

            listContainer.innerHTML = dataRecords.map(record => buildReportCard(record, false)).join('');
        }

        function displayAdminReports() {
            const listContainer = document.getElementById('list-admin');
            const countContainer = document.getElementById('count-admin');

            countContainer.textContent = '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ' + dataRecords.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';

            if (dataRecords.length === 0) {
                listContainer.innerHTML = '<div class="no-data"><div class="no-data-icon">üìã</div><div class="no-data-message">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div></div>';
                return;
            }

            listContainer.innerHTML = dataRecords.map(record => buildReportCard(record, true)).join('');
        }

        function searchDaily() {
            const selectedDate = document.getElementById('date-daily').value;
            if (!selectedDate) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', 'error');
                return;
            }

            const filteredData = dataRecords.filter(record => {
                if (!record.reportDate) return false;

                let recordDateString = record.reportDate;
                if (typeof recordDateString === 'string') {
                    recordDateString = recordDateString.split('T')[0];
                }

                return recordDateString === selectedDate;
            });

            const listContainer = document.getElementById('list-daily');
            const countContainer = document.getElementById('count-daily');

            countContainer.textContent = '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ' + convertDateToThai(selectedDate) + ' ‡∏°‡∏µ ' + filteredData.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';

            if (filteredData.length === 0) {
                listContainer.innerHTML = '<div class="no-data"><div class="no-data-icon">üìã</div><div class="no-data-message">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div></div>';
                return;
            }

            listContainer.innerHTML = filteredData.map(record => buildReportCard(record, false)).join('');
        }

        function buildReportCard(record, showActions) {
            const dateText = convertDateToThai(record.reportDate);
            const timeText = convertTime(record.dutyTime);
            const imageSection = record.imageUrl ? '<div class="report-picture"><img src="' + escapeText(record.imageUrl) + '" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô" onerror="this.style.display=\'none\'; this.alt=\'‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ\';"></div>' : '';

            // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö
            const acknowledgeStatus = record.acknowledged ? '<div class="acknowledged-badge">‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>' : '';

            // ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö)
            const dailyButtons = !showActions && !record.acknowledged ? '<div class="report-buttons"><button class="button-control button-acknowledge" onclick=\'showAcknowledgePopup(' + JSON.stringify(record).replace(/'/g, "&#39;") + ')\'>‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button></div>' : '';

            // ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏•‡∏ö)
            const adminButtons = showActions ? '<div class="report-buttons"><button class="button-control button-edit" onclick=\'showEditPasswordPopup(' + JSON.stringify(record).replace(/'/g, "&#39;") + ')\'>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button class="button-control button-delete" onclick=\'showDeletePopup(' + JSON.stringify(record).replace(/'/g, "&#39;") + ')\'>‡∏•‡∏ö</button></div>' : '';

            const buttonSection = dailyButtons || adminButtons;

            return '<div class="report-item"><div class="report-top"><div class="report-datetime">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ' + dateText + ' ‡πÄ‡∏ß‡∏•‡∏≤ ' + timeText + '</div>' + acknowledgeStatus + '</div><div class="report-content"><div class="content-field"><div class="field-title">‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</div><div class="field-text">' + escapeText(record.staffName) + '</div></div><div class="content-field"><div class="field-title">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div><div class="field-text">' + escapeText(record.position) + '</div></div><div class="content-field"><div class="field-title">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</div><div class="field-text">' + escapeText(record.location) + '</div></div><div class="content-field"><div class="field-title">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥</div><div class="field-text">' + escapeText(record.activity) + '</div></div>' + (record.eventDetail ? '<div class="content-field"><div class="field-title">‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div><div class="field-text">' + escapeText(record.eventDetail) + '</div></div>' : '') + (record.note ? '<div class="content-field"><div class="field-title">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div><div class="field-text">' + escapeText(record.note) + '</div></div>' : '') + '</div>' + imageSection + (buttonSection ? '<div style="margin-top: 15px;">' + buttonSection + '</div>' : '') + '</div>';
        }

        // ‡∏õ‡∏£‡∏±‡∏ö checkPassword ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏•‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function checkPassword() {
            const password = document.getElementById('input-password').value;
            if (password === SECRET_PASSWORD) {
                if (selectedDeleteRecord) {
                    const detailsHTML = '<div style="margin-bottom: 10px;"><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</strong> ' + convertDateToThai(selectedDeleteRecord.reportDate) + '</div><div style="margin-bottom: 10px;"><strong>‡πÄ‡∏ß‡∏•‡∏≤</strong> ' + convertTime(selectedDeleteRecord.dutyTime) + '</div><div style="margin-bottom: 10px;"><strong>‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</strong> ' + escapeText(selectedDeleteRecord.staffName) + '</div><div><strong>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</strong> ' + escapeText(selectedDeleteRecord.position) + '</div>';
                    document.getElementById('info-delete').innerHTML = detailsHTML;
                    document.getElementById('popup-password').classList.remove('show');
                    document.getElementById('popup-delete').classList.add('show');
                    document.getElementById('input-password').value = '';
                } else if (selectedEditPasswordRecord) {
                    document.getElementById('popup-password').classList.remove('show');
                    showEditPopup(selectedEditPasswordRecord);
                    selectedEditPasswordRecord = null;
                    document.getElementById('input-password').value = '';
                }
            } else {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
                document.getElementById('input-password').value = '';
                document.getElementById('input-password').focus();
            }
        }

        // ‡∏õ‡∏£‡∏±‡∏ö hidePasswordPopup ‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢
        function hidePasswordPopup() {
            document.getElementById('popup-password').classList.remove('show');
            document.getElementById('input-password').value = '';
            selectedDeleteRecord = null;
            selectedEditPasswordRecord = null;
        }

        function escapeText(text) {
            if (!text) return '';
            const element = document.createElement('div');
            element.textContent = text;
            return element.innerHTML;
        }

        function showEditPopup(record) {
            selectedEditRecord = record;

            let dateValue = record.reportDate;
            if (typeof dateValue === 'string' && dateValue.includes('T')) {
                dateValue = dateValue.split('T')[0];
            }

            document.getElementById('edit-date').value = dateValue;

            let timeValue = record.dutyTime || '';
            if (timeValue.includes('.')) {
                timeValue = timeValue.replace(' ‡∏ô.', '').replace('.', ':');
            }
            document.getElementById('edit-time').value = timeValue;
            document.getElementById('edit-staff').value = record.staffName || '';
            document.getElementById('edit-position').value = record.position || '';
            document.getElementById('edit-location').value = record.location || '';
            document.getElementById('edit-activity').value = record.activity || '';
            document.getElementById('edit-event').value = record.eventDetail || '';
            document.getElementById('edit-note').value = record.note || '';

            clearEditFile();

            if (record.imageUrl) {
                document.getElementById('img-edit').src = record.imageUrl;
                document.getElementById('name-edit').textContent = '‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô';
                document.getElementById('preview-edit').classList.add('show');
            }

            document.getElementById('popup-edit').classList.add('show');
        }

        function hideEditPopup() {
            document.getElementById('popup-edit').classList.remove('show');
            selectedEditRecord = null;
            clearEditFile();
        }

        function showDeletePopup(record) {
            selectedDeleteRecord = record;
            document.getElementById('popup-password').classList.add('show');
        }

        function hideDeletePopup() {
            document.getElementById('popup-delete').classList.remove('show');
            document.getElementById('input-password').value = '';
            selectedDeleteRecord = null;
        }

        function showAcknowledgePopup(record) {
            selectedAcknowledgeRecord = record;
            const detailsHTML = '<div style="margin-bottom: 10px;"><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</strong> ' + convertDateToThai(record.reportDate) + '</div><div style="margin-bottom: 10px;"><strong>‡πÄ‡∏ß‡∏•‡∏≤</strong> ' + convertTime(record.dutyTime) + '</div><div style="margin-bottom: 10px;"><strong>‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</strong> ' + escapeText(record.staffName) + '</div><div><strong>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</strong> ' + escapeText(record.position) + '</div>';
            document.getElementById('info-acknowledge').innerHTML = detailsHTML;
            document.getElementById('popup-acknowledge').classList.add('show');
            setTimeout(() => {
                document.getElementById('input-director-password').focus();
            }, 100);
        }

        function hideAcknowledgePopup() {
            document.getElementById('popup-acknowledge').classList.remove('show');
            document.getElementById('input-director-password').value = '';
            selectedAcknowledgeRecord = null;
        }

        async function executeAcknowledge() {
            if (!selectedAcknowledgeRecord) return;

            const password = document.getElementById('input-director-password').value;
            if (password !== DIRECTOR_PASSWORD) {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
                document.getElementById('input-director-password').value = '';
                document.getElementById('input-director-password').focus();
                return;
            }

            const confirmButton = document.getElementById('button-confirm-acknowledge');
            confirmButton.disabled = true;
            confirmButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';

            showSpinner('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö');

            try {
                const requestParams = new URLSearchParams({
                    action: 'acknowledge',
                    id: selectedAcknowledgeRecord.id
                });

                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    body: requestParams
                });

                const text = await response.text();
                let result;
                try {
                    result = JSON.parse(text);
                } catch (error) {
                    console.error('JSON Parse Error:', error, 'Response:', text);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÑ‡∏î‡πâ');
                }

                if (result.success) {
                    showNotification('‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    hideAcknowledgePopup();
                    await loadAllData();
                } else {
                    throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö');
                }
            } catch (error) {
                console.error('Acknowledge Error:', error);
                showNotification(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            } finally {
                confirmButton.disabled = false;
                confirmButton.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö';
                hideSpinner();
            }
        }

        async function executeDelete() {
            if (!selectedDeleteRecord) return;

            const deleteButton = document.getElementById('button-confirm-delete');
            deleteButton.disabled = true;
            deleteButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö';

            showSpinner('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô');

            try {
                const requestParams = new URLSearchParams({
                    action: 'delete',
                    id: selectedDeleteRecord.id
                });

                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    body: requestParams
                });

                const text = await response.text();
                let result;
                try {
                    result = JSON.parse(text);
                } catch (error) {
                    console.error('JSON Parse Error:', error, 'Response:', text);
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }

                if (result.success) {
                    showNotification('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    hideDeletePopup();
                    await loadAllData();
                } else {
                    throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö');
                }
            } catch (error) {
                console.error('Delete Error:', error);
                showNotification(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            } finally {
                deleteButton.disabled = false;
                deleteButton.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö';
                hideSpinner();
            }
        }

        document.getElementById('input-password').addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                checkPassword();
            }
        });

        document.getElementById('input-director-password').addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                executeAcknowledge();
            }
        });

        function convertDateToThai(dateString) {
            if (!dateString) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà';

            let dateStr = String(dateString);

            if (dateStr.includes('T')) {
                dateStr = dateStr.split('T')[0];
            }

            const parts = dateStr.split('-');
            if (parts.length !== 3) return dateStr;

            const year = parseInt(parts[0]);
            const month = parseInt(parts[1]);
            const day = parseInt(parts[2]);

            const date = new Date(Date.UTC(year, month - 1, day));

            const thaiYear = (date.getUTCFullYear() + 543);
            const displayMonth = date.getUTCMonth() + 1;
            const displayDay = date.getUTCDate();

            return displayDay + '/' + displayMonth + '/' + thaiYear;
        }

        function convertTime(timeString) {
            if (!timeString) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤';

            const timeStr = String(timeString);

            if (timeStr.indexOf(':') !== -1) {
                const parts = timeStr.split(':');
                return parts[0] + '.' + parts[1] + ' ‡∏ô.';
            }

            if (timeStr.indexOf('‡∏ô.') !== -1) {
                return timeStr;
            }

            return timeStr + ' ‡∏ô.';
        }

        function showSpinner(message) {
            document.getElementById('text-spinner').textContent = message;
            document.getElementById('overlay-spinner').classList.add('show');
        }

        function hideSpinner() {
            document.getElementById('overlay-spinner').classList.remove('show');
        }

        function showNotification(message, type) {
            const toast = document.getElementById('toast-notification');
            toast.textContent = message;
            toast.className = 'notification-toast show ' + (type || 'success');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        function showPrintPopup() {
            const currentDate = getCurrentDate();
            document.getElementById('date-print-start').value = currentDate;
            document.getElementById('date-print-end').value = currentDate;
            document.getElementById('popup-print').classList.add('show');
        }

        function hidePrintPopup() {
            document.getElementById('popup-print').classList.remove('show');
        }

        function createPrintPage() {
            const startDate = document.getElementById('date-print-start').value;
            const endDate = document.getElementById('date-print-end').value;

            if (!startDate || !endDate) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î', 'error');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                showNotification('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î', 'error');
                return;
            }

            const filteredData = dataRecords.filter(record => {
                if (!record.reportDate) return false;

                let recordDateString = record.reportDate;
                if (typeof recordDateString === 'string') {
                    recordDateString = recordDateString.split('T')[0];
                }

                return recordDateString >= startDate && recordDateString <= endDate;
            });

            if (filteredData.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', 'error');
                return;
            }

            hidePrintPopup();
            openPrintWindow(filteredData, startDate, endDate);
        }

        function openPrintWindow(records, startDate, endDate) {
            const printWindow = window.open('', '_blank');

            const startDateThai = convertDateToThaiLong(startDate);
            const endDateThai = convertDateToThaiLong(endDate);

            const systemTitle = document.getElementById('title-system').textContent;
            const organizationName = document.getElementById('title-organization').textContent;

            const recordsHTML = records.map((record, index) => {
                const dateText = convertDateToThaiLong(record.reportDate);
                const timeText = convertTime(record.dutyTime);

                const imageSection = record.imageUrl ? '<div style="margin-top: 15px; page-break-inside: avoid;"><img src="' + escapeText(record.imageUrl) + '" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô" style="max-width: 100%; max-height: 400px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onerror="this.style.display=\'none\';"></div>' : '';

                return '<div style="page-break-inside: avoid; margin-bottom: 30px; border: 2px solid #E3F2FD; border-radius: 12px; padding: 20px; background: #f8fbff;"><h3 style="color: #1976D2; margin-bottom: 15px; font-size: 20px; border-bottom: 2px solid #2196F3; padding-bottom: 10px;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà ' + (index + 1) + '</h3><table style="width: 100%; border-collapse: collapse; font-size: 16px;"><tr><td style="padding: 8px; font-weight: 600; color: #1976D2; width: 25%;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</td><td style="padding: 8px;">' + dateText + '</td><td style="padding: 8px; font-weight: 600; color: #1976D2; width: 25%;">‡πÄ‡∏ß‡∏•‡∏≤</td><td style="padding: 8px;">' + timeText + '</td></tr><tr><td style="padding: 8px; font-weight: 600; color: #1976D2;">‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</td><td style="padding: 8px;">' + escapeText(record.staffName) + '</td><td style="padding: 8px; font-weight: 600; color: #1976D2;">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</td><td style="padding: 8px;">' + escapeText(record.position) + '</td></tr><tr><td style="padding: 8px; font-weight: 600; color: #1976D2;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</td><td colspan="3" style="padding: 8px;">' + escapeText(record.location) + '</td></tr><tr><td style="padding: 8px; font-weight: 600; color: #1976D2; vertical-align: top;">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥</td><td colspan="3" style="padding: 8px; white-space: pre-wrap;">' + escapeText(record.activity) + '</td></tr>' + (record.eventDetail ? '<tr><td style="padding: 8px; font-weight: 600; color: #1976D2; vertical-align: top;">‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</td><td colspan="3" style="padding: 8px; white-space: pre-wrap;">' + escapeText(record.eventDetail) + '</td></tr>' : '') + (record.note ? '<tr><td style="padding: 8px; font-weight: 600; color: #1976D2; vertical-align: top;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</td><td colspan="3" style="padding: 8px; white-space: pre-wrap;">' + escapeText(record.note) + '</td></tr>' : '') + '</table>' + imageSection + '</div>';
            }).join('');

            const htmlContent = '<!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title><style>@import url(\'https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700;800&display=swap\');html{font-family:\'Sarabun\',sans-serif}*{margin:0;padding:0;box-sizing:border-box;font-family:\'Sarabun\',sans-serif}body{padding:40px;background:white;color:#333;font-family:\'Sarabun\',sans-serif}.header{text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:3px solid #2196F3}.header h1{color:#1976D2;font-size:28px;font-weight:700;margin-bottom:10px}.header h2{color:#2196F3;font-size:22px;font-weight:600;margin-bottom:5px}.header p{color:#666;font-size:18px;margin-top:10px}.summary{background:#E3F2FD;padding:15px 20px;border-radius:8px;margin-bottom:30px;text-align:center;font-size:18px;font-weight:600;color:#1976D2}@media print{body{padding:20px}.hide-print{display:none}@page{size:A4;margin:15mm}}.button-print{position:fixed;top:20px;right:20px;padding:12px 30px;background:linear-gradient(135deg,#4CAF50 0%,#388E3C 100%);color:white;border:none;border-radius:8px;font-size:18px;font-weight:600;cursor:pointer;box-shadow:0 4px 12px rgba(76,175,80,0.3);z-index:1000;font-family:\'Sarabun\',sans-serif}.button-print:hover{background:linear-gradient(135deg,#45a049 0%,#2E7D32 100%);transform:translateY(-2px);box-shadow:0 6px 16px rgba(76,175,80,0.4)}</style></head><body><button onclick="window.print()" class="button-print hide-print">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button><div class="header"><h1>' + escapeText(systemTitle) + '</h1><h2>' + escapeText(organizationName) + '</h2><p>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p><p>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ' + startDateThai + ' ‡∏ñ‡∏∂‡∏á ' + endDateThai + '</p></div><div class="summary">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ' + records.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div><div>' + recordsHTML + '</div><div style="margin-top:40px;text-align:center;color:#999;font-size:14px;page-break-inside:avoid;"><p>‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠ ' + new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' }) + '</p></div></body></html>';

            printWindow.document.write(htmlContent);
            printWindow.document.close();
        }

        function convertDateToThaiLong(dateString) {
            if (!dateString) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà';

            let dateStr = String(dateString);

            if (dateStr.includes('T')) {
                dateStr = dateStr.split('T')[0];
            }

            const parts = dateStr.split('-');
            if (parts.length !== 3) return dateStr;

            const year = parseInt(parts[0]);
            const month = parseInt(parts[1]);
            const day = parseInt(parts[2]);

            const date = new Date(Date.UTC(year, month - 1, day));

            const thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

            const thaiYear = date.getUTCFullYear() + 543;
            const thaiMonth = thaiMonths[date.getUTCMonth()];
            const thaiDay = date.getUTCDate();

            return thaiDay + ' ' + thaiMonth + ' ' + thaiYear;
        }

        document.addEventListener('DOMContentLoaded', startApp);
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9a8c8e96f4035f2e',t:'MTc2NDg2NDQ0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>